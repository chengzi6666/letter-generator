<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>信件生成器</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入html2canvas用于生成图片 -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- 引入JSZip用于打包下载 -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <!-- 引入FileSaver.js用于保存文件 -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <!-- 引入外部CSS文件 -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 bg-pattern min-h-screen font-sans text-gray-800">
    <!-- 页面头部 -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fa fa-envelope-o text-3xl text-primary mr-3"></i>
                    <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-gray-800">
                        <span class="text-primary">信件</span>生成器
                    </h1>
                </div>
                <div class="text-sm text-gray-500">
                    <p>简单几步，批量生成个性化信件</p>
                </div>
            </div>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧控制面板 -->
            <div class="lg:col-span-1 space-y-6">
                <!-- 背景图片选择区 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-image text-primary mr-2"></i>
                        背景选择
                    </h2>
                    <div class="space-y-4">
                        <p class="text-sm text-gray-500">选择一个模板或上传自定义图片</p>
                        
                        <!-- 默认模板选项 -->
                        <div class="grid grid-cols-2 gap-3">
                            <div class="template-option selected aspect-video rounded-lg overflow-hidden" data-template="template1">
                                <img src="template1.svg" alt="模板1" class="w-full h-full object-cover">
                            </div>
                            <div class="template-option aspect-video rounded-lg overflow-hidden" data-template="template2">
                                <img src="template2.svg" alt="模板2" class="w-full h-full object-cover">
                            </div>
                            <div class="template-option aspect-video rounded-lg overflow-hidden" data-template="template4">
                                <img src="template4.svg" alt="模板4" class="w-full h-full object-cover">
                            </div>
                        </div>
                        
                        <!-- 自定义图片上传 -->
                        <div class="mt-4">
                            <label class="file-upload-btn block w-full py-3 px-4 bg-blue-50 text-primary text-center rounded-lg border border-blue-200 cursor-pointer hover:bg-blue-100 transition-colors">
                                <i class="fa fa-upload mr-2"></i>
                                上传自定义背景
                                <input type="file" accept="image/*" id="custom-bg-upload">
                            </label>
                        </div>
                    </div>
                </section>
                
                <!-- 年级选择面板 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-graduation-cap text-primary mr-2"></i>
                        年级选择
                    </h2>
                    <div class="space-y-3">
                        <p class="text-sm text-gray-500">选择年级以应用对应的信件模板和老师列表</p>
                        <div class="grid grid-cols-5 gap-2">
                            <button class="grade-option py-3 px-2 bg-primary text-white rounded-lg text-center" data-grade="L1">L1</button>
                            <button class="grade-option py-3 px-2 bg-gray-200 text-gray-700 rounded-lg text-center" data-grade="L2">L2</button>
                            <button class="grade-option py-3 px-2 bg-gray-200 text-gray-700 rounded-lg text-center" data-grade="L3">L3</button>
                            <button class="grade-option py-3 px-2 bg-gray-200 text-gray-700 rounded-lg text-center" data-grade="L4">L4</button>
                            <button class="grade-option py-3 px-2 bg-gray-200 text-gray-700 rounded-lg text-center" data-grade="L5">L5</button>
                        </div>
                    </div>
                </section>
                
                <!-- 样式控制面板 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fa fa-paint-brush text-primary mr-2"></i>
                        样式设置
                    </h2>
                    
                    <!-- 字体设置 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-3">
                            <label class="block text-sm font-medium text-gray-700">字体选择</label>
                            <select id="font-family" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                                <option value="font-hand" selected>马善政 (Ma Shan Zheng)</option>
                                <option value="font-regular">常规手写体</option>
                                <option value="font-cursive">草体手写 (ZCOOL KuaiLe)</option>
                                <option value="font-elegant">优雅手写 (ZCOOL XiaoWei)</option>
                                <option value="font-yellow">黄游青科 (ZCOOL QingKe HuangYou)</option>
                                <option value="font-yuwei">余为楷体 (ZCOOL YuWei)</option>
                                <option value="font-noto">思源宋体 (Noto Serif SC)</option>
                                <option value="font-noto-sans">思源黑体 (Noto Sans SC)</option>
                                <option value="font-rounded">圆润字体 (M PLUS Rounded 1c)</option>
                                <option value="font-kite">简洁字体 (Kite One)</option>
                                <option value="font-noto-sans-tc">台湾思源黑体 (Noto Sans TC)</option>
                                <option value="font-noto-serif-tc">台湾思源宋体 (Noto Serif TC)</option>
                                <option value="font-gentle-hand">清晰温柔手写体</option>
                                <option value="font-anime-hand">二次元手写体</option>
                                <option value="font-camellia">山茶浪漫手写体</option>
                                <option value="font-romantic">浪漫心事手写体</option>
                                <option value="font-through-crowd">穿越人海手写体</option>
                                <option value="font-poetic">赋诗浪漫手写体</option>
                                <option value="font-miss-you">好想见你手写体</option>
                                <option value="font-song">宋体</option>
                                <option value="font-kai">楷体</option>
                                <option value="font-heiti">黑体</option>
                                <option value="font-sans">默认字体</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1 font-download-hint">
                                <i class="fa fa-info-circle"></i> 字体将自动从Google Fonts下载
                            </p>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="flex items-center justify-between text-sm font-medium text-gray-700">
                                <span>加粗显示</span>
                                <input type="checkbox" id="font-bold" class="w-5 h-5 text-primary focus:ring-primary border-gray-300 rounded">
                            </label>
                        </div>
                    </div>
                    
                    <!-- 字号设置 -->
                    <div class="mt-6 space-y-3">
                        <div class="flex items-center justify-between">
                            <label for="font-size" class="block text-sm font-medium text-gray-700">字号大小</label>
                            <span id="font-size-value" class="text-sm font-medium text-primary">24px</span>
                        </div>
                        <input type="range" id="font-size" min="12" max="72" value="24" class="w-full">
                    </div>
                      
                    <!-- 行间距设置 -->
                    <div class="mt-6 space-y-3">
                        <div class="flex items-center justify-between">
                            <label for="line-height" class="block text-sm font-medium text-gray-700">行间距</label>
                            <span id="line-height-value" class="text-sm font-medium text-primary">1.2</span>
                        </div>
                        <input type="range" id="line-height" min="1" max="3" step="0.1" value="1.2" class="w-full">
                    </div>
                    
                    <!-- 字体颜色设置 -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-3">
                            <label for="font-color" class="block text-sm font-medium text-gray-700">字体颜色</label>
                            <input type="color" id="font-color" value="#000000" class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div class="space-y-3">
                            <label for="highlight-color" class="block text-sm font-medium text-gray-700">高亮背景色</label>
                            <input type="color" id="highlight-color" value="#FFFF00" class="w-full h-10 border border-gray-300 rounded-lg">
                            <button id="apply-highlight" class="w-full px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg text-sm hover:bg-yellow-200 transition-colors">
                                应用高亮到选中文本
                            </button>
                        </div>
                    </div>
                    
                    <!-- 边距设置 -->
                    <div class="mt-6 space-y-4">
                        <h3 class="text-base font-medium text-gray-700">边距调整</h3>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <label for="margin-top" class="block text-sm font-medium text-gray-700">上边距</label>
                                <span id="margin-top-value" class="text-sm font-medium text-primary">20px</span>
                            </div>
                            <input type="range" id="margin-top" min="0" max="100" value="20" class="w-full">
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <label for="margin-right" class="block text-sm font-medium text-gray-700">右边距</label>
                                <span id="margin-right-value" class="text-sm font-medium text-primary">20px</span>
                            </div>
                            <input type="range" id="margin-right" min="0" max="200" value="20" class="w-full">
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <label for="margin-bottom" class="block text-sm font-medium text-gray-700">下边距</label>
                                <span id="margin-bottom-value" class="text-sm font-medium text-primary">20px</span>
                            </div>
                            <input type="range" id="margin-bottom" min="0" max="100" value="20" class="w-full">
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <label for="margin-left" class="block text-sm font-medium text-gray-700">左边距</label>
                                <span id="margin-left-value" class="text-sm font-medium text-primary">20px</span>
                            </div>
                            <input type="range" id="margin-left" min="0" max="100" value="20" class="w-full">
                        </div>
                    </div>
                    
                    <!-- 文本位置调整 -->
                    <div class="mt-6 space-y-4">
                        <h3 class="text-base font-medium text-gray-700">文本位置调整</h3>
                        <p class="text-sm text-gray-500">在预览区直接拖动信件内容调整位置</p>
                    </div>
                    
                    <!-- 模板图片调整 -->
                    <div class="mt-6 space-y-4">
                        <h3 class="text-base font-medium text-gray-700">模板图片调整</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <label for="template-size" class="block text-sm font-medium text-gray-700">图片大小 (%)</label>
                                <span id="template-size-value" class="text-sm font-medium text-primary">100%</span>
                            </div>
                            <input type="range" id="template-size" min="50" max="150" value="100" class="w-full">
                        </div>
                        <p class="text-sm text-gray-500">在预览区拖动背景图片可以调整其位置</p>
                    </div>
                </section>
                
                <!-- 姓名列表输入区 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-users text-primary mr-2"></i>
                        姓名列表
                    </h2>
                    <div class="space-y-3">
                        <p class="text-sm text-gray-500">每行输入一个姓名（支持批量粘贴）</p>
                        <textarea id="name-list" rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="张三
李四
王五
..."></textarea>
                        <div class="flex items-center">
                            <input type="checkbox" id="show-full-name" class="w-4 h-4 text-primary rounded focus:ring-primary">
                            <label for="show-full-name" class="ml-2 block text-sm text-gray-700">显示学员全称（如不勾选，3字及以上姓名仅显示最后两个字）</label>
                        </div>
                        <div class="text-sm text-gray-500 flex justify-between items-center">
                            <span>支持300个左右姓名</span>
                            <span id="name-count">0 个姓名</span>
                        </div>
                    </div>
                </section>
                
                <!-- 信件内容输入区 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-pencil text-primary mr-2"></i>
                        信件内容
                    </h2>
                    <div class="space-y-3">
                        <p class="text-sm text-gray-500">使用"XX"作为姓名占位符</p>
                        <textarea id="letter-content" rows="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="亲爱的XX同学：

    你好！

    这是一封测试信件内容。

此致
敬礼！

李老师
2023年10月1日">我最亲爱的XX：
    当你读到这封信时，咱们秋季的语文之旅已经走过一半啦～这 7 讲里，我们跟着文字 "环游世界做苹果派"，在 "极境特快" 里感受 "先声夺人写开头" 的魅力，还在 "城市里的小房子" 中品味四季流转之美…… 你看，语文就像一座神奇的桥梁，把课本里的故事和生活里的美好紧紧连在一起，你每次认真分析段落、积极分享想法的模样，老师都记在心里呢～
    后半程还有更多惊喜在等着我们：我们会跟着 "青蛙和蟾蜍" 探寻友谊的真谛，用 "创意日记" 把心里的奇思妙想一一记录，还能在 "三星堆与山海经" 的奇遇里，触摸古老神话与文明的温度；甚至会跟着 "神笔马良" 思考 "如何正确帮助他人"，在 "新桃旧符" 里感受华夏祝福的浪漫…… 这些充满趣味与智慧的内容，都在等着和XX相遇呀～
    XX，希望你能一直带着对语文的热爱与好奇，在接下来的学习里继续大胆探索、尽情表达。老师会一直陪着XX，一起把这段秋季的学习旅程，变成又一段闪闪发光的回忆～
                                                                                                                                           始终期待你成长的，
                                                                                                                                                           XX老师</textarea>
                    </div>
                </section>
                
                <!-- 老师署名选择区 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i>
                        老师署名
                    </h2>
                    <div class="space-y-3">
                        <select id="teacher-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                            <option value="天贻老师">天贻老师</option>
                            <option value="一凡老师">一凡老师</option>
                            <option value="杨洋老师">杨洋老师</option>
                            <option value="custom">自定义...</option>
                        </select>
                        <input type="text" id="custom-teacher-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all hidden" placeholder="请输入老师姓名">
                    </div>
                </section>
            </div>
            
            <!-- 右侧预览区 -->
            <div class="lg:col-span-2 space-y-6">
                <!-- 信件预览区 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-eye text-primary mr-2"></i>
                        信件预览
                    </h2>
                    <div class="flex justify-center items-center">
                        <div id="letter-preview" class="w-full max-w-2xl aspect-[3/4] mx-auto bg-white p-8 relative">
                            <!-- 模板图片容器 -->
                            <div id="template-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 1;">
                                <img src="template1.svg" alt="模板背景" style="width: 100%; height: 100%; object-cover;">
                            </div>
                            <!-- 文本容器 -->
                            <div id="text-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 20px; box-sizing: border-box; pointer-events: auto; z-index: 2;">
                                <div id="letter-content-preview" class="font-hand text-24 text-gray-800 leading-relaxed" style="font-size: 24px; line-height: 1.8;">
                                    我最亲爱的XX：

        当你读到这封信时，咱们秋季的语文之旅已经走过一半啦～这 7 讲里，我们跟着文字 "环游世界做苹果派"，在 "极境特快" 里感受 "先声夺人写开头" 的魅力，还在 "城市里的小房子" 中品味四季流转之美…… 你看，语文就像一座神奇的桥梁，把课本里的故事和生活里的美好紧紧连在一起，你每次认真分析段落、积极分享想法的模样，老师都记在心里呢～

        后半程还有更多惊喜在等着我们：我们会跟着 "青蛙和蟾蜍" 探寻友谊的真谛，用 "创意日记" 把心里的奇思妙想一一记录，还能在 "三星堆与山海经" 的奇遇里，触摸古老神话与文明的温度；甚至会跟着 "神笔马良" 思考 "如何正确帮助他人"，在 "新桃旧符" 里感受华夏祝福的浪漫…… 这些充满趣味与智慧的内容，都在等着和XX相遇呀～

        XX，希望你能一直带着对语文的热爱与好奇，在接下来的学习里继续大胆探索、尽情表达。老师会一直陪着XX，一起把这段秋季的学习旅程，变成又一段闪闪发光的回忆～

                                                                                                                                                   始终期待你成长的，
                                                                                                                                                                   XX老师
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- 操作按钮区 -->
                <section class="bg-white rounded-xl p-6 card-shadow">
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <button id="download-single" class="px-8 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg shadow transition-all flex-1 md:flex-none">
                            <i class="fa fa-download mr-2"></i>
                            下载当前信件
                        </button>
                        <button id="generate-all" class="px-8 py-3 bg-success hover:bg-green-600 text-white rounded-lg shadow transition-all flex-1 md:flex-none">
                            <i class="fa fa-refresh mr-2"></i>
                            批量生成所有信件
                        </button>
                        <button id="download-all" class="px-8 py-3 bg-warning hover:bg-yellow-600 text-white rounded-lg shadow transition-all flex-1 md:flex-none hidden">
                            <i class="fa fa-file-archive-o mr-2"></i>
                            打包下载全部
                        </button>
                    </div>
                    
                    <!-- 生成状态提示 -->
                    <div id="generation-status" class="mt-6 text-center hidden">
                        <div class="loader mb-2"></div>
                        <p id="status-text" class="text-sm text-gray-600">处理中...</p>
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- 页面底部 -->
    <footer class="bg-white shadow-inner py-6 mt-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>信件生成器 &copy; 2023 | 简单、高效的个性化信件批量生成工具</p>
        </div>
    </footer>
    
    <!-- 引入外部JavaScript文件 -->
    <script src="script.js"></script>
</body>
</html>